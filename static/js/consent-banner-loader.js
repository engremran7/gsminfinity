(()=>{(function(){"use strict";if(typeof window<"u"&&window.__CONSENT_BANNER_LOADER_LOADED__)return;typeof window<"u"&&(window.__CONSENT_BANNER_LOADER_LOADED__=!0),window.AppConsent=window.AppConsent||{};var d={cookieName:"consent_status",endpoints:{banner:"/consent/banner/",acceptAll:"/consent/accept_all/",rejectAll:"/consent/reject_all/",accept:"/consent/accept/"},bannerSlotId:"consent-banner-slot",bannerId:"consent-banner",toastsId:"app-toasts",autoLoad:!0},i=function(){try{if(typeof window<"u"&&window.CONSENT_CONFIG&&typeof window.CONSENT_CONFIG=="object"){var e={};for(var t in d)e[t]=d[t];for(var n in window.CONSENT_CONFIG)Object.prototype.hasOwnProperty.call(window.CONSENT_CONFIG,n)&&n!=="endpoints"&&(e[n]=window.CONSENT_CONFIG[n]);return e.endpoints=Object.assign({},d.endpoints,window.CONSENT_CONFIG.endpoints||{}),e}}catch{}return d}(),N=String(i.cookieName||d.cookieName),h=Object.assign({},d.endpoints,i.endpoints||{}),y=i.bannerSlotId||d.bannerSlotId,l=i.bannerId||d.bannerId,w=i.toastsId||d.toastsId,_=typeof i.autoLoad<"u"?!!i.autoLoad:d.autoLoad;function b(e){try{if(!e||typeof document>"u"||!document.cookie)return null;for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n].trim();if(r.indexOf(e+"=")===0)return decodeURIComponent(r.substring(e.length+1))}}catch(a){console.debug("consent-banner-loader.getCookie error:",a)}return null}function C(){try{var e=b(N);if(!e)return!1;if(e==="1"||e==="true")return!0;try{var t=JSON.parse(e);if(t&&typeof t=="object"){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&t[n])return!0}}catch{}return!1}catch(r){return console.debug("consent-banner-loader.hasConsentCookie error:",r),!1}}function T(){try{var e=document.querySelector('meta[name="csrf-token"]')||document.querySelector('meta[name="csrfmiddlewaretoken"]')||document.querySelector('meta[name="X-CSRFToken"]')||null;return e?e.content:null}catch{return null}}function p(e,t){t=t||{};var n=new Headers(t.headers||{});try{n.has("X-Requested-With")||n.set("X-Requested-With","XMLHttpRequest")}catch{}try{var r=null;try{r=window.AppUI&&typeof window.AppUI.getCsrfToken=="function"?window.AppUI.getCsrfToken():null}catch{}r=r||b("csrftoken")||T();r&&!n.has("X-CSRFToken")&&n.set("X-CSRFToken",r)}catch{}return fetch(e,{method:t.method||"GET",credentials:"same-origin",headers:n,body:t.body||null})}function g(e){try{if(!e||!e.querySelectorAll)return;e.querySelectorAll("script").forEach(function(n){n.parentNode&&n.parentNode.removeChild(n)});var t={DIV:!0,P:!0,SPAN:!0,BUTTON:!0,A:!0,UL:!0,LI:!0,INPUT:!0,LABEL:!0,SECTION:!0,ARTICLE:!0,FORM:!0};e.querySelectorAll("*").forEach(function(n){if(!t[n.tagName]){n.remove();return}for(var r=n.attributes.length-1;r>=0;r--){var a=n.attributes[r].name,c=n.attributes[r].value||"";if(/^on/i.test(a)){n.removeAttribute(a);continue}/^(href|src)$/i.test(a)&&(/^\s*javascript:/i.test(c)||/^\s*data:text\/html/i.test(c))&&n.removeAttribute(a)}})}catch(n){console.debug("consent-banner-loader.sanitizeFragment:",n)}}function O(){try{var e=document.getElementById(y);if(!e){var t=document.getElementById(l);t&&t.parentElement&&(e=t.parentElement)}return e||(e=document.createElement("div"),e.id=y,e.style.position="relative",e.style.zIndex=99999,(document.body||document.documentElement).appendChild(e)),e}catch(n){return console.debug("consent-banner-loader.ensureSlot:",n),null}}function s(){try{var e=document.getElementById(l);e&&e.parentElement&&e.parentElement.removeChild(e);var t=document.getElementById(y);t&&!t.hasChildNodes()&&t.parentElement&&t.parentElement.removeChild(t)}catch(n){console.debug("consent-banner-loader.removeBanner:",n)}}function A(e){try{if(!e||typeof e!="string")return;var t=O();if(!t)return;var n=document.createElement("template");n.innerHTML=e.trim();var r=n.content.cloneNode(!0);g(r);var a=r.firstElementChild||null,c=document.getElementById(l);if(c&&a){try{if(c.isEqualNode(a))return}catch{}c.parentNode&&c.parentNode.removeChild(c)}for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(r),I()}catch(o){console.error("consent-banner-loader.renderBanner:",o)}}function S(){try{var e=document.getElementById(w);return e||(e=document.createElement("div"),e.id=w,e.style.position="fixed",e.style.top="16px",e.style.right="16px",e.style.zIndex=1e5,document.body.appendChild(e)),e}catch{return null}}function u(e){try{if(!e)return;var t=document.createElement("div");t.innerHTML=e;var n=t.querySelector(".toast")||t.querySelector(".toast-body");if(!n)return;var r=n.cloneNode(!0);g(r);var a=S();if(!a)return;a.appendChild(r);try{window.bootstrap&&window.bootstrap.Toast?new window.bootstrap.Toast(r).show():setTimeout(function(){try{r.remove()}catch{}},3500)}catch{setTimeout(function(){try{r.remove()}catch{}},3500)}}catch(c){console.debug("consent-banner-loader.injectToastFromHtml:",c)}}function m(e){try{if(!e)return;var t=S();if(!t)return;var n=document.createElement("div");n.className="toast show bg-dark text-white p-3 mb-2 rounded shadow-lg",n.textContent=String(e),t.appendChild(n),setTimeout(function(){try{n.remove()}catch{}},3500)}catch{}}function f(e,t){try{return!e||!e.querySelector?null:e.querySelector('[data-consent-action="'+t+'"]')||e.querySelector('[data-hx-action="'+t+'"]')||e.querySelector("#"+t.replace(/\W/g,"-"))||null}catch{return null}}function I(){try{var e=document.getElementById(l);if(!e||e.dataset&&e.dataset.handlersAttached==="1")return;e.dataset&&(e.dataset.handlersAttached="1");var t=f(e,"accept-all"),n=f(e,"reject-all"),r=f(e,"close");t&&!t._attached&&(t.addEventListener("click",function(o){o.preventDefault(),k()}),t._attached=!0),n&&!n._attached&&(n.addEventListener("click",function(o){o.preventDefault(),L()}),n._attached=!0),r&&!r._attached&&(r.addEventListener("click",function(o){o.preventDefault(),s()}),r._attached=!0);var a=e.querySelectorAll('input[type="checkbox"][data-consent-slug]')||[];a.length||(a=e.querySelectorAll('input[type="checkbox"]')||[]);for(var c=0;c<a.length;c++)(function(o){o._attached||(o.addEventListener("change",function(){window.__consent_save_timeout&&clearTimeout(window.__consent_save_timeout),window.__consent_save_timeout=setTimeout(q,250)}),o._attached=!0)})(a[c])}catch(o){console.debug("consent-banner-loader.attachHandlers:",o)}}async function k(){try{var e=await p(h.acceptAll,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({accept_all:"1"}).toString()}),t="";try{t=await e.text()}catch{}s();try{var n=JSON.parse(t||"{}");n&&n.message?m(n.message):u(t)}catch{u(t)}}catch(r){console.error("consent-banner-loader.doAcceptAll:",r),m("Failed to accept cookies \u2014 please try again.")}}async function L(){try{var e=await p(h.rejectAll,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({reject_all:"1"}).toString()}),t="";try{t=await e.text()}catch{}s();try{var n=JSON.parse(t||"{}");n&&n.message?m(n.message):u(t)}catch{u(t)}}catch(r){console.error("consent-banner-loader.doRejectAll:",r),m("Failed to reject cookies \u2014 please try again.")}}async function q(){try{var e=document.getElementById(l);if(!e)return;var t={},n=e.querySelectorAll('input[type="checkbox"][data-consent-slug]')||[];n.length||(n=e.querySelectorAll('input[type="checkbox"]')||[]);for(var r=0;r<n.length;r++){var a=n[r];try{var c=a.getAttribute("data-consent-slug")||a.dataset&&(a.dataset.consentSlug||a.dataset.consent_slug||a.dataset.consent)||a.name||null;if(!c)continue;t[String(c)]=!!a.checked}catch{}}var o=await p(h.accept,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o||!o.ok){console.warn("consent-banner-loader.saveGranularPreferences: server returned",o&&o.status);return}try{var v=await o.json();v&&v.message&&m(v.message)}catch{var x=await o.text();u(x)}}catch(j){console.error("consent-banner-loader.saveGranularPreferences:",j)}}async function E(){try{if(C()){s();return}var e=await p(h.banner,{method:"GET"});if(!e||!e.ok)return;var t=await e.text();if(!t||!t.trim()){s();return}A(t)}catch(n){console.error("consent-banner-loader.loadBanner:",n)}}try{_&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):setTimeout(E,0))}catch(e){console.debug("consent-banner-loader.init:",e)}})();})();
