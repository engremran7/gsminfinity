{% extends "base.html" %}
{% block title %}Dashboard - {{ site_settings.site_name|default:"GSMInfinity" }}{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
    <aside class="lg:col-span-1">
      {% include "includes/dashboard_sidebar.html" %}
    </aside>

    <section class="lg:col-span-3 space-y-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
          <h1 class="text-2xl font-semibold text-slate-900">Dashboard</h1>
          <p class="text-sm text-slate-600 mt-1">
            Welcome back, {{ request.user.email|default:"user" }}.
          </p>
        </div>
        <div class="bg-white shadow rounded-lg px-4 py-3">
          <p class="text-sm text-slate-700 font-medium inline-flex items-center gap-1"><svg class="icon w-4 h-4" aria-hidden="true"><use href="#icon-devices"></use></svg>Devices</p>
          <p class="text-lg font-semibold text-slate-900">
            {{ device_used|default:0 }} / {{ device_limit|default:0 }}
            <span class="text-xs font-normal text-slate-500 ml-2">remaining {{ device_remaining|default:0 }}</span>
          </p>
          <a href="{% url 'users:devices' %}" class="text-xs text-primary hover:underline mt-1 inline-block">Manage devices</a>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-lg font-medium text-slate-900 inline-flex items-center gap-2"><svg class="icon w-4 h-4" aria-hidden="true"><use href="#icon-megaphone"></use></svg>Announcements</h2><p class="text-xs text-slate-500 mt-1">Latest system and account updates.</p>
          <div class="mt-3 space-y-3">
            {% if announcements %}
              {% for a in announcements %}
              <div class="border border-slate-100 rounded-lg p-3">
                <p class="text-sm font-semibold text-slate-900">{{ a.title|default:"(untitled)" }}</p>
                <p class="text-xs text-slate-500">{{ a.start_at|date:"M j, Y" }}</p>
                <p class="text-sm text-slate-700 mt-1">{{ a.message|truncatechars:140 }}</p>
              </div>
              {% endfor %}
            {% else %}
              <p class="text-sm text-slate-600">No announcements.</p>
            {% endif %}
          </div>
        </div>
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-lg font-medium text-slate-900 inline-flex items-center gap-2"><svg class="icon w-4 h-4" aria-hidden="true"><use href="#icon-bell"></use></svg>Notifications</h2><p class="text-xs text-slate-500 mt-1">Security and activity alerts.</p>
          <div class="mt-3 space-y-3">
            {% if notifications %}
              {% for n in notifications %}
              <div class="border border-slate-100 rounded-lg p-3">
                <p class="text-sm font-semibold text-slate-900">{{ n.title|default:"Notification" }}</p>
                <p class="text-xs text-slate-500">{{ n.created_at|date:"M j, Y" }}</p>
                <p class="text-sm text-slate-700 mt-1">{{ n.message|default:n.body|truncatechars:140 }}</p>
              </div>
              {% endfor %}
            {% else %}
              <p class="text-sm text-slate-600">No notifications.</p>
            {% endif %}
          </div>
        </div>
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-lg font-medium text-slate-900 inline-flex items-center gap-2"><svg class="icon w-4 h-4" aria-hidden="true"><use href="#icon-user"></use></svg>Account</h2><p class="text-xs text-slate-500 mt-1">Profile, credits, and security status.</p>
          <ul class="text-sm text-slate-700 space-y-2 mt-3">
            <li>Email: {{ request.user.email|default:"-" }}</li>
            <li>Credits: {{ credits|default:"0" }}</li>
            <li>Payments enabled: {{ can_pay|yesno:"Yes,No" }}</li>
            <li>Ads available: {{ can_watch_ad|yesno:"Yes,No" }}</li>
            <li>Devices: {{ device_used|default:0 }} / {{ device_limit|default:0 }}</li>
            <li>Remaining slots: {{ device_remaining|default:0 }}</li>
          </ul>
          <div class="mt-4 space-y-2">
            <a href="{% url 'users:profile' %}" class="text-primary text-sm">Go to profile</a><br>
            <a href="{% url 'account_change_password' %}" class="text-primary text-sm">Change password</a>
            <br>
            <a href="{% url 'users:devices' %}" class="text-primary text-sm">Manage devices</a>
            <div class="mt-3 space-y-2 text-xs text-slate-600">
              <div class="flex items-center justify-between">
                <span>Reset slot (watch ad)</span>
                <button class="px-2 py-1 text-xs rounded border border-slate-200 text-slate-700 bg-white hover:bg-slate-50" disabled>
                  Coming soon
                </button>
              </div>
              <div class="flex items-center justify-between">
                <span>Reset slot (payment)</span>
                <button class="px-2 py-1 text-xs rounded border border-slate-200 text-slate-700 bg-white hover:bg-slate-50" disabled>
                  Coming soon
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
{% endblock %}

