{% extends "base.html" %}
{% block title %}Devices â€” {{ site_settings.site_name|default:"GSMInfinity" }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10">
  <h1 class="text-2xl font-semibold text-slate-900 mb-4">Devices</h1>
  <p class="text-slate-600 mb-6">Manage the devices registered to your account. Resetting will deactivate until next login.</p>

  {% if devices %}
  <div class="space-y-3">
    {% for d in devices %}
    <div class="bg-white shadow rounded-lg p-4 flex items-center justify-between">
      <div>
        <p class="text-sm font-semibold text-slate-900 inline-flex items-center gap-2">
          <svg class="icon w-4 h-4 text-slate-500" aria-hidden="true"><use href="#icon-shield"></use></svg>
          {{ d.fingerprint_hash_short|default:d.fingerprint_hash|slice:":12" }}
        </p>
        <p class="text-xs text-slate-500 inline-flex items-center gap-2 mt-1">
          <svg class="icon w-4 h-4 text-slate-400" aria-hidden="true"><use href="#icon-clock"></use></svg>
          Last used: {{ d.last_used_at|date:"M j, Y, P"|default:"-" }}
        </p>
        <p class="text-xs text-slate-500 inline-flex items-center gap-2 mt-1">
          <svg class="icon w-4 h-4 text-slate-400" aria-hidden="true"><use href="#icon-devices"></use></svg>
          OS/Browser: {{ d.os_info|default:"-" }} / {{ d.browser_info|default:"-" }}
        </p>
      </div>
      <div class="text-right">
        {% if d.is_active %}
          <span class="inline-block px-2 py-1 text-xs rounded bg-green-100 text-green-800">Active</span>
        {% else %}
          <span class="inline-block px-2 py-1 text-xs rounded bg-slate-200 text-slate-700">Inactive</span>
        {% endif %}
        <div class="mt-2">
          {% if request.user.is_staff or request.user.is_superuser %}
            <form method="post" action="{% url 'users:device_reset' d.pk %}">
              {% csrf_token %}
              <button type="submit" class="text-sm text-red-600 hover:underline">Deactivate</button>
            </form>
          {% else %}
            <span class="text-xs text-slate-400 inline-flex items-center gap-1">
              <svg class="icon w-3 h-3 text-slate-400" aria-hidden="true"><use href="#icon-alert-triangle"></use></svg>
              Resetting deactivates the device until next login.
            </span>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="text-sm text-slate-600">No devices recorded.</p>
  {% endif %}
</div>
{% endblock %}
